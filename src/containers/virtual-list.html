<html>

<head>
  <style>
    .red {
      border-bottom: 1px solid red;
      color: red;
      padding:1rem;
    }

    .blue {
      border-bottom: 1px solid blue;
      color: blue;
      padding:1rem;
      margin-bottom: 0.4rem;
    }

    .v-container {
      border: 0px solid black;
    }

    .v-item-x-1 {
      display: block;
      word-break: break-all;
    }

    .hovered {
      background-color: rgb(255, 102, 0);
    }

    .selected {
      background-color: yellow;
    }

    .hovered.selected {
      background-color: rgb(205, 210, 247);
    }

  </style>
</head>

<body>

  <mettle-virtual-list data-dynamic></mettle-virtual-list>

  <script type="module">
    //data-dynamic
    import './mettle-virtual-list.js'


    window.customElements.define('tag-one', class extends HTMLElement {
      constructor() {
        super()
      }
      async connectedCallback() {
        this.innerHTML = `<div class="blue">data test</div>`
        this.$div = this.querySelector('div')
      }
      updateModel(data) {
        if (data && this.$div) {
          this.$div.innerHTML = data
        }
      }
    })

    window.customElements.define('tag-two', class extends HTMLElement {
      constructor() {
        super()
      }
      async connectedCallback() {
        this.innerHTML = `<div class="red">data</div>`
        this.$div = this.querySelector('div')
      }
      updateModel(data) {
        if (data && this.$div) {
          this.$div.innerText = data
        }
      }
    })


    const $viewTableBody = document.querySelector('mettle-virtual-list')

    const characters ='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';

    function generateString(length) {
        let result = ' ';
        const charactersLength = characters.length;
        length = Math.ceil(Math.random() * length)
        for ( let i = 0; i < length; i++ ) {
            result += ' '+ characters.charAt(Math.floor(Math.random() * charactersLength));
        }

        return result;
    }

    function getListItemsSet(min=1) {
      const randomArray = () => [...new Array(min)].map((element, index) => `<big>${(index+1)}</big><small> ${generateString(1000)}</small>`)
      return randomArray()
    }

    function getListItems() {
      const  arrCount = Math.ceil(Math.random()*2000)
      const randomArray = (length, max) => [...new Array(length)].map(() => Math.round(Math.random() * max))
      return randomArray(arrCount, 4000)
    }

    function getListItemsSame() {
      const randomArray = (length, max) => [...new Array(length)].map(() => Math.round(Math.random() * max))
      return randomArray(20, 4000)
    }

    const listitemsstatic = getListItemsSame()
    //listitemsstatic[0] = undefined
    //listitemsstatic[1] = undefined

    /*$viewTableBody.render({
      displayAmt: 5,
      listItems: getListItemsSet(1, 50),
      tag: 'tag-one'
    })*/

    //console.log(getListItemsSet(5, 50))
    /* changing list
    setInterval(() => {
      $viewTableBody.render({
        displayAmt: 3,
        listItems: getListItems(),
        tag: 'tag-one'
      })
    }, 2000)
    */

    //const itemsLong = getListItemsSet(100)

    setTimeout(() => {
      $viewTableBody.render({
        listItems: getListItemsSet(10),
        renderRow: () => {
          const elem = document.createElement('tag-one')
          elem.classList.add('v-item-x')
          return elem
        },
        updateRow: (elem, data) => {
          elem.updateModel(data)
        }
      })
      console.log('update 1')
    }, 1000)

    setInterval(() => {
     $viewTableBody.appendItems(getListItemsSet(5))
     /* $viewTableBody.render({
        listItems: getListItemsSet(5)
      })*/
      //console.count('appended')
    }, 3000)

    /*
    console.dir(Object.assign(document.createElement('tag-one'), {class: 'test', 'data-test': 'test'}))


    const tagRef = document.createElement('tag-one')
    Object.entries({
        class: 'carouselItem',
        loading: 'eager',
        'data-showtime': '10'
    }).forEach(([key, value]) => {
        tagRef.setAttribute(key, value);
    })

    document.body.appendChild(tagRef)
    console.dir(tagRef)
*/


   /*setTimeout(() => {
      $viewTableBody.render({
        displayAmt: 5,
        listItems: getListItemsSet(2, 50),
        tag: 'tag-one'
      })
      console.log('size5')
    }, 2000)

    setTimeout(() => {
      $viewTableBody.render({
        displayAmt: 7,
        listItems: getListItems(),
        tag: 'tag-one'
      })
      console.log('size4')
    }, 3000)*/


  </script>

</body>

</html>
